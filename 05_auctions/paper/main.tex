\documentclass[11pt,a4paper]{article}
%\usepackage[pdftex]{graphicx,color}
\usepackage{graphicx,color}
\usepackage{amsmath,amssymb,dsfont,fullpage,epsfig,multirow,longtable}
\usepackage{epsfig,epstopdf,hhline}
\usepackage{cases}
\usepackage{wrapfig}
\usepackage{algorithm}
%\usepackage[noend]{algorithmic}
\usepackage{algorithmic}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\usepackage[numbers]{natbib}
\usepackage[top=0.5 in, bottom=1 in, left=1 in, right=1 in, letterpaper]{geometry}
\usepackage{tikz}
\usetikzlibrary{arrows,positioning,decorations.pathreplacing,shapes}

\usepackage{thmtools}
\usepackage{thm-restate}
\usepackage{enumerate}

% Ours
\usepackage{enumerate}
\usepackage{mdframed}
\usepackage{setspace}
\usepackage{caption}
\setlength{\textfloatsep}{8pt}

%\declaretheorem[name=Theorem]{thm}

% for affiliation
\usepackage{authblk}

%%%%%%%%%% Start TeXmacs macrosÆ’
\newenvironment{proof}{\noindent\emph{Proof\ }}{\hspace*{\fill}$\Box$\medskip}
\newenvironment{claimproof}{\noindent\emph{Proof of claim\ }}{\hspace*{\fill}$\Box$\medskip}
\newenvironment{plainproof}{\noindent\emph{Proof\ }}{}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}
\newtheorem{lemma}{Lemma}
\newtheorem{claim}{Claim}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}
\usepackage{amsmath}
\usepackage{paralist}
\usepackage{framed}

%%comment in algorithms
\renewcommand{\algorithmiccomment}[1]{\hfill  {\small  \tt \# #1}}

\newcommand\restr[2]{{% we make the whole thing an ordinary symbol
  \left.\kern-\nulldelimiterspace % automatically resize the bar with \right
  #1 % the function
  \vphantom{\big|} % pretend it's a little taller at normal size
  \right|_{#2} % this is the delimiter
  }}

\newcommand{\pred}{\texttt{pred}}
\newcommand{\vect}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\one}{\ensuremath{\mathds{1}}}
\newcommand{\PoA}{\text{PoA}}
\newcommand{\E}{\ensuremath{\mathbb{E}}}
% bullet dot
\newcommand\sbullet[1][.75]{\mathbin{\vcenter{\hbox{\scalebox{#1}{$\bullet$}}}}}

\usepackage[utf8]{inputenc} % Required for inputting international characters
\usepackage[T5]{fontenc} % Output font encoding for international characters

\usepackage{color, colortbl}
\usepackage{hyperref}
\usepackage{xfrac}
\hypersetup{colorlinks,
            linkcolor=blue,
            citecolor=blue,
            urlcolor=magenta,
            linktocpage,
            plainpages=false}
\usepackage[capitalise,noabbrev]{cleveref}



\newcommand{\comment}[1]{\textcolor{blue}{{\footnotesize
#1}}\marginpar{\raggedright\tiny \textcolor{blue}{Comment}}}


\begin{document}

\section{Problem}

The problem consists of $n$ buyers, where each buyer $i$ has a budget $B_i$. Additionally, the buyers have an evaluation function $V_i : [0,1] -> \mathbb{R}^+$, which is non-decreasing and concave. The auctioneer lists one item only, for which the buyers can submit a private bid $b_i$, such that $0 \le b_i \le B_i$. From the bid $b_i$, buyer $i$ receives a fraction $d_i = \sfrac{b_i}{B}$ of the item, where $B = \sum_i b_i$. The utility of buyer $i$ is $U_i(\vec{b}) = V_i(d_i) - b_i$. The goal is to maximize the effective welfare of the buyers: $EW_i(\vec{b}) = \min\{B_i,\ V_i(d_i)\}$

\section{Formulation}

The following formulation transforms the initial problem to finding the solution that maximizes the effective welfare among all possible solutions. For simplicity, the fractions of assignments are discretized ($d_i \in k_{\epsilon} : 0 \le k \le \sfrac{1}{\epsilon}$). A solution $S = \{(i, d_i) : 0 \le d_i \le 1\}$ assigns a fraction to each buyer, such that $\sum_{(i,d_{i}) \in S} d_{i} \le 1$. The variable $z_S$ indicates which solution is chosen.

\begin{minipage}[t]{0.59\textwidth}
	\begin{align*}
		&& \max  \sum_{S \subseteq \mathcal{S}} &c_{S}\ z_{S} \\
		(\beta) && \sum_{i=1}^{n} \sum_{d_{i}} d_{i} \sum_{S: (i,d_{i}) \in S } z_{S} &= 1 & & \\
		(\gamma) && \sum_{S} z_{S}  &= 1	& & \\
		&& z_{S} &\geq 0 & & \forall i, \forall S \subseteq \mathcal{S}\\
	\end{align*}
\end{minipage}
\begin{minipage}[t]{0.3\textwidth}
	\begin{align*}
		\min \beta &+ \gamma \\
		\sum_{(i,d_{i}) \in S} d_{i} \beta + \gamma &\geq c_{S}  & & \forall S \subseteq \mathcal{S}\\
\end{align*}
\end{minipage}


\section{Setting the dual variables}

Consider a Nash equilibrium $\vect{b}$. Let $d_{i}^*$ be the fraction received by $i$ in the equilibrium ($d^{*}_{i}~=~\sfrac{b_{i}}{B}$).
Using the KKT conditions (similar to Chapter 21 of AGT book), for any bidder $i$ with the equilibrium bid $0 < b_{i} < B_{i}$, we have
$$
\hat{V}'_{i}\biggl( \frac{b_{i}}{B} \biggr)
= V'_{i}\biggl( \frac{b_{i}}{B} \biggr) \cdot \biggl( 1 - \frac{b_{i}}{B} \biggr)
= B
$$
where $B = \sum_{j=1}^{n} b_{j}$ is the sum of the bids.
Note that for all bidders $i$ and $i'$ such that $0 < b_{i}, b_{i'} < B_{i}$ then
$ \hat{V}'_{i}(d^{*}_{i})  = \hat{V}'_{i'}(d_{i'}^*)$.
%
Let us define the dual variables $\beta$ and $\gamma$ as the following:
\begin{align*}
	\beta &= \hat{V}'_{i}(d^{*}_{i}) = B\\
	\gamma &= \sum_{i=1}^{n} \gamma_{i}\\
\gamma_{i} &= \begin{cases}
	B_{i} \text{ if } V_{i}(d^{*}_{i}) \geq B_{i}, \\
	2 V_{i}(d^{*}_{i}) -   d^{*}_{i} \hat{V}'_{i}(d^{*}_{i})
\end{cases}
\end{align*}

\paragraph{Feasibility.}
The dual constraints reads
\begin{align*}
\sum_{(i,d_{i}) \in S} d_{i} \beta + \gamma &\geq c_{S} \\
%
\Leftrightarrow
\sum_{(i,d_{i}) \in S} d_{i} \hat{V}'_{i}(d^{*}_{i})  + \sum_{i=1}^{n} \gamma_{i} &\geq \sum_{(i,d_{i}) \in S} \min\{V_{i}(d_{i}), B_{i}\}
\end{align*}
%
We prove the above inequality for each term $i$. If $\gamma_{i} = B_{i}$ then it is trivial. Now assume that
$\gamma_{i} = 2 V_{i}(d^{*}_{i}) -   d^{*}_{i} \hat{V}'_{i}(d^{*}_{i})$ (meaning that $V_{i}(d^{*}_{i}) < B_{i}$).
We have
%
\begin{align*}
\hat{V}'_{i}(d^{*}_{i})  + \gamma_{i}
&= d_{i} \hat{V}'_{i}(d^{*}_{i})  + 2 V_{i}(d^{*}_{i}) -   d^{*}_{i} \hat{V}'_{i}(d^{*}_{i})
= 2 V_{i}(d^{*}_{i}) + \hat{V}'_{i}(d^{*}_{i}) (d_{i} - d^{*}_{i}) \\
%
&= 2 V_{i}(d^{*}_{i}) + V'_{i}(d^{*}_{i})(1 - d^{*}_{i}) (d_{i} - d^{*}_{i}) \\
%
&= V_{i}(d^{*}_{i}) + V'_{i}(d^{*}_{i})(d_{i} - d^{*}_{i}) + V_{i}(d^{*}_{i})  - V'_{i}(d^{*}_{i}) d^{*}_{i} (d_{i} - d^{*}_{i}) \\
%
&\geq V_{i}(d_{i}) + V_{i}(d^{*}_{i})  - V'_{i}(d^{*}_{i}) d^{*}_{i} (d_{i} - d^{*}_{i}) \\
%
&\geq V_{i}(d_{i}) + V_{i}(d^{*}_{i})  - V'_{i}(d^{*}_{i}) \frac{d^{*}_{i}}{d_{i}} (d_{i} - d^{*}_{i})
\end{align*}
The first inequality is due to the concavity of $V_{i}$ and the second holds since $d_{i} \leq 1$.
It remains to prove that $V_{i}(d^{*}_{i})  - V'_{i}(d^{*}_{i}) \frac{d^{*}_{i}}{d_{i}} (d_{i} - d^{*}_{i}) \geq 0$.
If $d_{i} \leq d^{*}_{i}$ then the inequality follows immediately. Assume that $d_{i} = \rho \cdot d^{*}_{i}$ for $\rho > 1$.
Therefore,
\begin{align*}
V_{i}(d^{*}_{i})  - V'_{i}(d^{*}_{i}) \frac{d^{*}_{i}}{d_{i}} (d_{i} - d^{*}_{i})
&= V_{i}(d^{*}_{i})  - \frac{\rho - 1}{\rho} V'_{i}(d^{*}_{i}) d^{*}_{i} \\
%
&\geq V_{i}(d^{*}_{i})  - V'_{i}(d^{*}_{i}) d^{*}_{i} \geq V_{i}(0) \geq 0
\end{align*}
The second inequality follows the concavity of $V_{i}$. We deduce that the feasibility holds.

\paragraph{Primal and Dual.}
The ratio between primal and dual is at most 2.

\begin{align*}
	&& 2\sum_{(i,d_{i}) \in S} \min\{V_i(d_i^*), B_i \} &\ge \beta + \gamma\\
	\forall\ i : && 2 \min\{V_i(d_i^*), B_i \} &\ge b_i + \gamma_i \\
	\textnormal{if } V_i(d_i^*) \ge B_i : && 2B_i &\ge b_i + B_i\\
	\textnormal{otherwise :} && 2 V_i(d_i^*) &\ge b_i + 2 V_{i}(d^{*}_{i}) - d^{*}_{i} \hat{V}'_{i}(d^{*}_{i})\\
	\textnormal{since : } && b_i - d^{*}_{i} \hat{V}'_{i}(d^{*}_{i}) &= b_i - \frac{b_i}{B} B = 0\\
	&& 2 V_{i}(d^{*}_{i}) &\ge 2 V_{i}(d^{*}_{i})
\end{align*}

\paragraph{Remark.} To complete the analysis, one must consider cases where all equilibrium bids are either $B_{i}$ or 0. The PoA, in this case, is 1.

\end{document}